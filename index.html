<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <title>
      Share to HN – A PWA that gives you a mobile sharing menu item for Hacker
      News
    </title>

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ff6600" />
  </head>

  <body>
    <h1 style="color: #ff6600">Share to HN</h1>

    <p>
      A super simple PWA (<a
        href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps"
        target="_blank"
        rel="noopener noreferrer nofollow"
        >progressive web app</a
      >) that adds an option for
      <a
        href="https://news.ycombinator.com/"
        target="_blank"
        rel="noopener noreferrer nofollow"
        >Hacker News</a
      >
      to the sharing menu in your Android device.
    </p>

    <a
      href="https://user-images.githubusercontent.com/3490745/189770958-7436a8c7-e6ae-4d2a-beaa-333d6f14d1ba.png"
      target="_blank"
      rel="noopener noreferrer nofollow"
      style="margin: 1rem 0;"
    >
      <img
        src="https://user-images.githubusercontent.com/3490745/189770958-7436a8c7-e6ae-4d2a-beaa-333d6f14d1ba.png"
        alt="Demonstration of how the sharing UX looks like on Chrome for Android"
        style="width: 80vw; max-width: 830px;"
      />
    </a>

    <p>
      In other words, it's a handy mobile alternative for the
      <a
        href="https://news.ycombinator.com/bookmarklet.html"
        target="_blank"
        rel="noopener noreferrer nofollow"
        >official HN bookmarklet</a
      >. That bookmarklet doesn't work in all mobile browsers, at least not in
      Chrome for Android.
    </p>

    <p>
      ⚠️ The PWA utilizes the experimental <code>share_target</code> attribute
      in the
      <a
        href="https://developer.mozilla.org/en-US/docs/Web/Manifest"
        target="_blank"
        rel="noopener noreferrer nofollow"
        >manifest</a
      >, which as of September 2022 is only supported by Chrome and Edge. Check
      the up-to-date browser support info at
      <a
        href="https://caniuse.com/mdn-html_manifest_share_target"
        target="_blank"
        rel="noopener noreferrer nofollow"
      >
        caniuse.com</a
      >.
    </p>

    <hr style="margin-top: 1.5rem; margin-bottom: 1.5rem" />

    <p>
      <a
        href="https://github.com/samulisuomi/share-to-hn-pwa"
        target="_blank"
        rel="noopener noreferrer nofollow"
        >GitHub
      </a>
    </p>

    <script>
      window.addEventListener("load", () => {
        registerSW();
      });

      window.addEventListener("DOMContentLoaded", () => {
        readParams();
      });

      // Register the Service Worker
      async function registerSW() {
        if ("serviceWorker" in navigator) {
          try {
            await navigator.serviceWorker.register("serviceworker.js");
          } catch (e) {
            console.log("SW registration failed");
          }
        }
      }

      function readParams() {
        const parsedUrl = new URL(window.location);

        if (!parsedUrl.search) return;

        const titleParam = parsedUrl.searchParams.get("title")?.trim();
        const textParam = parsedUrl.searchParams.get("text")?.trim();
        const urlParam = parsedUrl.searchParams.get("url")?.trim();

        const possibleUrlInTextParam = textParam.split("http")[1]
          ? `http${textParam.split("http")[1]}`
          : null;

        const url = isValidUrl(possibleUrlInTextParam)
          ? possibleUrlInTextParam
          : isValidUrl(urlParam)
          ? urlParam
          : null;

        window.location = `https://news.ycombinator.com/submitlink?u=${encodeURIComponent(
          url || ""
        )}&t=${encodeURIComponent(titleParam || "")}`;
      }

      function isValidUrl(urlString) {
        try {
          return Boolean(new URL(urlString));
        } catch (e) {
          return false;
        }
      }
    </script>
  </body>

  <style type="text/css">
    body {
      font-family: Verdana, Geneva, sans-serif;
      text-align: center;
      padding: 2rem;
      margin: 0 auto;
      line-height: 1.33334;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1,
    hr,
    p {
      max-width: 512px;
    }

    p {
      margin: 1rem 0;
    }

    hr {
      width: 100%;
    }
  </style>
</html>
